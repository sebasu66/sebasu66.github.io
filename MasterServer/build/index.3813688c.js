var e;let t;const n={connected_to_main_server:"connected_to_main_server",connected_to_game_server:"connected_to_game_server",disconnected_from_game_server:"disconnected_from_game_server",disconnected_from_main_server:"disconnected_from_main_server",obtained_game_servers_list:"obtained_game_servers_list",refresh_game_servers_list:"refresh_game_servers_list",connect_to_game_server:"connect_to_game_server"};function r(e,t){let n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}function o(e,t){Array.isArray(e)||(e=[e]),e.forEach(e=>{document.addEventListener(e,t)})}let s=[];function c(e){s.push(e),function(){let e=document.getElementById("status-list");e.innerHTML="";let t=document.createElement("ul");e.appendChild(t),s.length>6&&(s=s.slice(s.length-6));for(let e=0;e<s.length;e++){let n=document.createElement("li");n.innerHTML=s[e],t.appendChild(n)}}()}const i=new class{constructor(e="http://localhost:3000"){this.mainServerUrl=e,this.mainServerSocket=null,this.gameServerUrl=null,this.gameServerSocket=null,this.playerId=null,this.LGSList=[],this.connectStatus={connectedToLobby:!1,connectedToGame:!1}}connectToMainServer(){this.mainServerSocket=io(this.mainServerUrl),this.mainServerSocket.on("connect",()=>{this.connectStatus.connectedToLobby=!0,r(n.connected_to_main_server,this.connectStatus),console.log("connected to main server"),this.getLGSList(),document.addEventListener(n.refresh_game_servers_list,e=>{this.getLGSList()}),document.addEventListener(n.connect_to_game_server,e=>{console.log("connect to game server event received: "+JSON.stringify(e.detail)),this.connectToGameServer(e.detail)})}),this.mainServerSocket.on("disconnect",()=>{this.connectStatus.connectedToLobby=!1,this.connectStatus.connectedToGame=!1,r(n.disconnected_from_main_server,this.connectStatus),console.log("disconnected from main server")}),this.mainServerSocket.on("LGSList",e=>{this.LGSList=e,console.log("LGSList received: "+JSON.stringify(this.LGSList)),r(n.obtained_game_servers_list,this.LGSList)})}getLGSList(){this.mainServerSocket.emit("getLGSList"),console.log("getLGSList sent")}connectToGameServer(e){this.gameServerUrl=e,this.gameServerSocket&&this.gameServerSocket.disconnect(),console.log("connecting to game server: "+this.gameServerUrl),this.gameServerSocket=io(this.gameServerUrl),this.gameServerSocket.on("connect",()=>{this.connectStatus.connectedToGame=!0,r(n.connected_to_game_server,this.connectStatus),console.log("connected to game server"),this.gameServerSocket.onAny((e,t)=>{console.log("game server event received: "+e+" "+JSON.stringify(t))}),this.sendPlayerId(this.gameServerSocket)}),this.gameServerSocket.on("disconnect",()=>{this.connectStatus.connectedToGame=!1,r(n.disconnected_from_game_server,this.connectStatus),this.connectToMainServer()})}sendPlayerId(e){let t=this.generatePlayerId();e.emit("playerId",t),console.log("playerId sent: "+t)}generatePlayerId(){let e=localStorage.getItem("playerId");return e||(e=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),localStorage.setItem("playerId",e)),e}}("http://localhost:3000");o(n.connected_to_main_server,e=>{c("Conectado al servidor principal")}),o(n.disconnected_from_main_server,e=>{c("Desconectado del servidor principal")}),o(n.connected_to_game_server,e=>{c("Conectado al servidor de juego")}),o(n.disconnected_from_game_server,e=>{c("Desconectado del servidor de juego")}),o(n.obtained_game_servers_list,e=>{(function(e){let t=document.getElementById("servers");t.innerHTML="";let n=t.insertRow(),r=n.insertCell(),o=n.insertCell(),s=n.insertCell();r.innerHTML="<b>Server</b>",o.innerHTML="<b>Players</b>",s.innerHTML="<b>Join</b>";for(let n=0;n<e.length;n++){let r=t.insertRow(),o=r.insertCell(),s=r.insertCell(),c=r.insertCell();o.innerHTML=e[n].name,s.innerHTML=e[n].players,c.innerHTML="<button onclick=\"document.dispatchEvent(new CustomEvent('connect_to_game_server', {detail: '"+e[n].url+"'}));\">Join</button>"}})(e.detail)}),document.getElementById("refreshLGSListButton").addEventListener("click",function(){console.log("refresh LGSList button clicked"),document.dispatchEvent(new Event(n.refresh_game_servers_list))}),document.addEventListener("*",function(e){console.log("event: "+e.type+" data: "+JSON.stringify(e.detail))}),i.connectToMainServer(),document.addEventListener("pending_redraw",e=>{console.log("pending_redraw"),GAME.canvas.renderAll()}),document.addEventListener("message_received",e=>{c(e.detail)}),e=i.playerId,t=new fabric.IText("PLAYER: "+e,{left:10,top:10,fontSize:16,fill:"black",selectable:!1}),GAME.canvas.add(t),fabric.Object.prototype.transparentCorners=!1,fabric.util.loadImage("resources/green3.jpg",function(e){for(var t=new fabric.Pattern({source:e,repeat:"no-repeat",selectable:!1,hasBorders:!1,hasControls:!1}),n=e.width-5,r=0;r<1e4;r+=n)for(var o=0;o<1e4;o+=n){var s=new fabric.Rect({left:r,top:o,width:n,height:n,fill:t,selectable:!1,hasBorders:!1,hasControls:!1});GAME.canvas.add(s)}GAME.canvas.renderAll()}),GAME.canvas.on("object:moving",function(e){}),GAME.canvas.on("object:modified",function(e){c("dragged "+e.target.id+" to "+e.target.left+","+e.target.top,GAME.canvas),i.mainServersocketClient.emit("move",{id:e.target.id,pos:{x:e.target.left,y:e.target.top}})});
//# sourceMappingURL=index.3813688c.js.map
